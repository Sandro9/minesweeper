import{a as S,b as K,d as Q,e as V}from"./chunk-KLIRNKYH.js";import{h as J}from"./chunk-Q5SRHD2C.js";import{b as h}from"./chunk-MBUDMCZA.js";import{H as u,M as O,N as L,P as D,T as a,U as d,V as g,X as w,Y as A,Z as l,_ as j,aa as q,ba as U,ca as W,e as f,ea as x,ga as Y,ha as z,j as v,ja as H,l as E,n as T,na as b,qa as y,t as m,u as p}from"./chunk-LJMMMWJ7.js";var C=class{constructor(t,e,n){this.target_id=t,this.source=e,this.target=n}unlink(){let t=this.target.connections;this.target.connections=this.filterNodes(t,this.source.id);let e=this.source.connections;this.source.connections=this.filterNodes(e,this.target_id)}filterNodes(t,e){return t.filter(n=>n.target_id!==e)}};var M=class{get connections(){return this._connections}set connections(t){this._connections=t}get connectedPoints(){return this.connections.map(t=>t.target)}constructor(t,e){this.id=t,this.position=e,this._connections=[]}addConnectedNode(t){if(this.connections.some(n=>n.target.id===t.id))return;let e=new C(t.id,this,t);this._connections.push(e),t._connections.push(new C(this.id,t,this))}removeConnectedNode(t){let e=this.connections.find(n=>n.target.id===t.id);e&&e.unlink()}hasConnectionTo(t){return this.connections.find(e=>e.target_id===t.id)}};var _=class extends M{};var k=class extends _{constructor(t,e,n){super(t,e),this.value=n,this.type="field",this.isFlagged=!1,this.isRevealed=!1}reveal(){this.isRevealed=!0}getIsRevealed(){return this.isRevealed}toggleFlag(){this.isFlagged=!this.isFlagged}getIsFlagged(){return this.isFlagged}};var N=class{constructor(t=0,e=[]){this._id=t,this._nodes=e}get id(){return this._id}get nodes(){return this._nodes}tryAddNode(t){try{if(this._nodes.some(e=>e.id===t.id))throw new Error("already exists");this._nodes.push(t)}catch{console.log("err")}}tryAddConnection(t,e){t.addConnectedNode(e)}getUniqueNodes(){return this._nodes.filter((t,e)=>this._nodes.findIndex(n=>n.id===t.id)===e)}getUniqueConnections(){return this._nodes.flatMap(t=>t.connections).filter((t,e)=>this._nodes.flatMap(n=>n.connections))}getNodeById(t){return this._nodes.find(e=>e.id===t)}getNodeByPoint(t){return this._nodes.find(e=>e.position.equals(t))}isNodeNeighbour(t,e){return t.connections.some(n=>n.target.id===e.id)}};var F=class{constructor(t,e){this.x=t,this.y=e}equals(t){return this.x===t.x&&this.y===t.y}};var G=class extends _{constructor(){super(...arguments),this.type="mine",this.isFlagged=!1,this.isRevealed=!1}reveal(){this.isRevealed=!0,console.error("BOOOOM")}getIsRevealed(){return this.isRevealed}toggleFlag(){this.isFlagged=!this.isFlagged}getIsFlagged(){return this.isFlagged}};var $=class{constructor(t){this._playgroundBase=t,this._graph=new N,this.fillAndConnectGraph(this._graph,t)}fillAndConnectGraph(t,e){for(let n=0;n<e.length;n++)for(let i=0;i<e[n].length;i++){let s=e[n][i],r=new F(i,n),c=`${i}-${n}`;s==="mine"?t.tryAddNode(new G(c,r)):t.tryAddNode(new k(c,r,s)),this.connectNeighbours(t,r)}}connectNeighbours(t,e){let n=t.getNodeByPoint(e),i=[`${e.x}-${e.y-1}`,`${e.x}-${e.y+1}`,`${e.x-1}-${e.y}`,`${e.x+1}-${e.y}`,`${e.x-1}-${e.y-1}`,`${e.x-1}-${e.y+1}`,`${e.x+1}-${e.y-1}`,`${e.x+1}-${e.y+1}`];n&&i.forEach(s=>{let r=t.getNodeById(s);r&&t.tryAddConnection(n,r)})}getGraph(){return this._graph}getPlaygroundBase(){return this._playgroundBase}};var P=class{constructor(t,e){this.meta=t,this.grid=e,this.flagModeActive$=new f(!1),this.hasWon=new f(!1),this.hasLost=new f(!1)}fieldInteraction(t){this.flagModeActive$.value?this.flagField(t):this.unrevealField(t)}unrevealField(t){let e=this.grid.getGraph()?.getNodeById(t);if(!e)throw new Error(`No node found for index ${t}`);if(e.reveal(),e.type==="mine"){this.hasLost.next(!0);return}e.value===0&&e.connections.forEach(n=>{let i=this.grid.getGraph().getNodeById(n.target.id);i&&!i.getIsRevealed()&&i.type!=="mine"&&this.unrevealField(n.target_id)})}flagField(t){let e=this.grid.getGraph()?.getNodeById(t);if(this.grid.getGraph()?.nodes.filter(i=>i.getIsFlagged()).length>this.meta.totalMines)throw new Error("Cannot flag more nodes as there are mines");if(!e)throw new Error(`No node found for index ${t}`);if(e.toggleFlag(),this.checkWinCondition()){this.hasWon.next(!0);return}}toggleFlagMode(){this.flagModeActive$.next(!this.flagModeActive$.value)}checkWinCondition(){return this.grid.getGraph()?.nodes.filter(e=>e.getIsFlagged()&&e.type==="mine").length===this.meta.totalMines}};var B=class{constructor(t){this._seedGenerator=t}generatePlayground(t){let{width:e,height:n}=t.dimensions,i=t.seed??1,s=this.generateBase(e,n),r=this.fillBaseNeighbours(s);return new P({dimensions:t.dimensions,seed:this._seedGenerator.getSeed(),totalMines:this.countMines(s)},new $(s))}generateBase(t,e){let n=[];for(let i=0;i<e;i++){n[i]===void 0&&(n[i]=[]);for(let s=0;s<t;s++)n[i][s]=this._seedGenerator.random()<.1?"mine":0}return n}fillBaseNeighbours(t){for(let e=0;e<t.length;e++)for(let n=0;n<t[e].length;n++)if(t[e][n]===0){let i=0;for(let s=-1;s<=1;s++)for(let r=-1;r<=1;r++){if(s===0&&r===0)continue;let c=n+r,R=e+s;c>=0&&c<t[e].length&&R>=0&&R<t.length&&(i+=t[R][c]==="mine"?1:0)}t[e][n]=i}return t}countMines(t){return t.reduce((e,n)=>e+n.filter(i=>i==="mine").length,0)}};var I=class o{constructor(t){this.seed=o.stringToSeed(t)}getSeed(){return this.seed}static stringToSeed(t){let e=0;for(let n=0;n<t.length;n++)e+=t.charCodeAt(n);return e}lcg(){return this.seed=(this.seed*1664525+1013904223)%4294967296,this.seed/4294967296}random(){return this.lcg()}randomInRange(t,e){return t+this.random()*(e-t)}};var Z=(()=>{class o{constructor(){this._gameService=m(S),this._router=m(y),this.timeMS=h(this._gameService.timeMS),this._meta=h(this._gameService.gameMetadata),this.seed=H(()=>{let e=this._meta();return e?e.seed:"unknown"})}newGame(){this._router.navigateByUrl("/settings")}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=p({type:o,selectors:[["app-win"]],standalone:!0,features:[x],decls:23,vars:4,consts:[[1,"flex","flex-col","background","p-4","rounded-3xl","background","w-[350px]","max-sm:w-screen","max-sm:h-screen","max-sm","max-sm:justify-center","max-sm:rounded-none"],[1,"flex","justify-center"],[1,"text-3xl","p-2","rounded","glow","w-fit","text-slate-200"],[1,"text-2xl","text-gray-200","mt-8"],[1,"flex","text-gray-200","gap-8","text-base","mt-3"],[1,"blueTextGradient","font-extrabold"],[1,"flex","text-gray-200","gap-8","text-base"],[1,""],[1,"flex","text-gray-200","gap-8","mt-12"],[1,"flex","flex-row","items-center","gap-2","button","px-4","py-2",3,"click"],["src","assets/flag.png",1,"w-4","h-4"],["disabled","",1,"ml-auto","px-4","py-2","rounded","bg-blue-400","text-slate-200","disabled:opacity-80"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"div",1)(2,"h2",2),l(3,"You won!"),d()(),a(4,"h3",3),l(5,"Stats:"),d(),a(6,"div",4)(7,"div"),l(8,"Time:"),d(),a(9,"div",5),l(10),Y(11,"appTime"),d()(),a(12,"div",6)(13,"div"),l(14,"Seed:"),d(),a(15,"div",7),l(16),d()(),a(17,"div",8)(18,"button",9),w("click",function(){return i.newGame()}),l(19," New Game "),g(20,"img",10),d(),a(21,"button",11),l(22,"Share"),d()()()),n&2&&(u(10),j(z(11,2,i.timeMS())),u(6),j(i.seed()))},dependencies:[b,Q],styles:["[_nghost-%COMP%]{display:block}.glow[_ngcontent-%COMP%]{box-shadow:inset 80px 0 120px #d9683c,inset -30px 0 120px #eed5cc}.background[_ngcontent-%COMP%]{background-color:#1f1b18}.blueTextGradient[_ngcontent-%COMP%]{background:#b7deed;background:radial-gradient(circle farthest-corner at center center,#b7deed,#71ceef 25%,#21b4e2 75%,#b7deed);-webkit-background-clip:text;-webkit-text-fill-color:transparent}"],changeDetection:0})}}return o})();var ee=(()=>{class o{constructor(){this._router=m(y)}newGame(){this._router.navigateByUrl("/settings")}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=p({type:o,selectors:[["app-lost"]],standalone:!0,features:[x],decls:8,vars:0,consts:[[1,"flex","flex-col","background","p-4","rounded-3xl","background","w-[350px]","max-sm:w-screen","max-sm:h-screen","max-sm","max-sm:justify-center","max-sm:rounded-none"],[1,"flex","justify-center"],[1,"text-3xl","p-2","rounded","glow","w-fit","text-slate-200"],[1,"flex","text-gray-200","gap-8","mt-12","justify-center"],[1,"flex","flex-row","items-center","gap-2","button","px-4","py-2",3,"click"],["src","assets/flag.png",1,"w-4","h-4"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"div",1)(2,"h2",2),l(3,"You Lost!"),d()(),a(4,"div",3)(5,"button",4),w("click",function(){return i.newGame()}),l(6," New Game "),g(7,"img",5),d()()())},dependencies:[b],styles:["[_nghost-%COMP%]{display:block}.background[_ngcontent-%COMP%]{background-color:#1f1b18}.glow[_ngcontent-%COMP%]{box-shadow:inset 80px 0 120px #d9683c,inset -30px 0 120px #eed5cc}"],changeDetection:0})}}return o})();function te(o,t){o&1&&g(0,"app-win")}function ne(o,t){o&1&&g(0,"app-lost")}function ie(o,t){if(o&1&&(a(0,"div",0),g(1,"app-info-bar",1)(2,"app-domrenderer",1),d()),o&2){A(2);let e=W(0);u(),L("playground",e),u(),L("playground",e)}}function oe(o,t){if(o&1&&O(0,ie,3,2,"div",0),o&2){A();let e=W(0);D(e!==void 0?0:-1)}}var it=(()=>{class o{constructor(){this._gameState=m(S),this._settings=m(J),this._router=m(y),this.activePlayground$=new f(void 0),this.playground=h(this.activePlayground$),this.hasLost=h(this.activePlayground$.pipe(v(e=>e!==void 0),E(e=>e.hasLost),v(e=>e),T(()=>this._gameState.endRound()))),this.hasWon=h(this.activePlayground$.pipe(v(e=>e!==void 0),E(e=>e.hasWon),v(e=>e),T(()=>this._gameState.endRound())))}ngOnInit(){let e=this._settings.settingsForm.value;if(e.seed==null||e.x==null||e.y==null){this._router.navigate(["/settings"]);return}this.generatePlaygroundByConfig({seed:e.seed,x:e.x,y:e.y}),this.startGame()}generatePlaygroundByConfig(e){let{seed:n,y:i,x:s}=e,r=new I(n),c=new B(r).generatePlayground({dimensions:{width:s,height:i}});this.activePlayground$.next(c),this._gameState.gameMetadata.next(c.meta),this._gameState.minesCount.next(c.meta.totalMines)}startGame(){this._gameState.startRound()}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=p({type:o,selectors:[["app-game"]],standalone:!0,features:[x],decls:4,vars:2,consts:[[1,"flex","flex-col","gap-6","background","p-4","rounded-3xl","min-w-[450px]"],[3,"playground"]],template:function(n,i){n&1&&(q(0),O(1,te,1,0,"app-win")(2,ne,1,0,"app-lost")(3,oe,1,1)),n&2&&(U(i.playground()),u(),D(i.hasWon()?1:i.hasLost()?2:3))},dependencies:[K,V,Z,ee],styles:["[_nghost-%COMP%]{display:block;display:flex;min-height:100vh;align-items:center;justify-content:center}.background[_ngcontent-%COMP%]{background-color:#1f1b18}"],changeDetection:0})}}return o})();export{it as GameComponent};
